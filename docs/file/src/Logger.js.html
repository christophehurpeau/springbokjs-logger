<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Logger.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/christophehurpeau/nightingale" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ConsoleLogger.js~ConsoleLogger.html">ConsoleLogger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Handler.js~Handler.html">Handler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Logger.js~Logger.html">Logger</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LogLevel">LogLevel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-levels">levels</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">formatters</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-format">format</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-style">style</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-format">format</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-style">style</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-format">format</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-style">style</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-style">style</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">handlers</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/handlers/ConsoleHandler.js~ConsoleHandler.html">ConsoleHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/handlers/StringHandler.js~StringHandler.html">StringHandler</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">layouts</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/layouts/LayoutDefault.js~LayoutDefault.html">LayoutDefault</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/layouts/LayoutHTML.js~LayoutHTML.html">LayoutHTML</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">outputs</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/outputs/OutputFile.js~OutputFile.html">OutputFile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/outputs/OutputString.js~OutputString.html">OutputString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-write">write</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">processors</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/processors/WebProcessor.js~WebProcessor.html">WebProcessor</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Logger.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import util from &apos;util&apos;;
import LogLevel from &apos;./LogLevel&apos;;

/**
 * Interface that allows you to log records.
 * This records are treated by handlers
 */
export default class Logger {
    /**
     * Create a new Logger
     *
     * @param {Handler[]} handlers
     */
    constructor(handlers) {
        this.handlers = handlers;

        Object.getOwnPropertyNames(Logger.prototype).forEach((key) =&gt; {
            if (key === &apos;constructor&apos;) {
                return;
            }

            this[key] = Logger.prototype[key].bind(this);
        });
    }

    /**
     * Write a message
     *
     * @param {String} message
     * @param {String} logLevel
     * @return {Logger}
     */
    write(message, logLevel) {
        this.output.write(message, logLevel);
        return this;
    }

    /**
     * Handle a record
     *
     * Use this only if you know what you are doing.
     *
     * @param {Object} record
     */
    addRecord(record) {
        for (let i = 0, length = this.handlers.length; i &lt; length; i++) {
            let handler = this.handlers[i];
            if (handler.handle(record) === false) {
                return;
            }
        }
    }

    /**
     * Log a message
     *
     * @param {String} message
     * @param {Object} context
     * @param {int} [logLevel]
     * @param {Object} [options]
     * @return {Logger}
     */
    log(message, context, logLevel = LogLevel.INFO, options = undefined) {
        let record = {
            level: logLevel,
            prefix: this._prefix,
            datetime: new Date(),
            message: message,
            context: context,
            extra: {},
        };

        if (options) {
            record = Object.assign(options, record);
        }

        this.addRecord(record);
        return this;
    }

    /**
     * Set the logger prefix
     *
     * @param {String} prefix
     * @param {*} [styles]
     */
    setPrefix(prefix, styles) {
        this._prefix = prefix;
    }

    /**
     * Log an debug message
     *
     * @param {String} message
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    debug(message, context, contextStyles) {
        return this.log(message, context, LogLevel.DEBUG, { contextStyles });
    }

    /**
     * Log an info message
     *
     * @param {String} message
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    info(message, context, contextStyles) {
        return this.log(message, context, LogLevel.INFO, { contextStyles });
    }

    /**
     * Log an warn message
     *
     * @param {String} message
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    warn(message, context, contextStyles) {
        return this.log(message, context, LogLevel.WARN, { contextStyles });
    }

    /**
     * Log an error message
     *
     * @param {String|Error} message
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    error(message, context, contextStyles) {
        return this.log(message.stack || message.message || message, context, LogLevel.ERROR, { contextStyles });
    }

    /**
     * Log an alert message
     *
     * @param {String} message
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    alert(message, context, contextStyles) {
        return this.log(message, context, LogLevel.ALERT, { contextStyles });
    }

    /**
     * Log an fatal message
     *
     * @param {String} message
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    fatal(message, context, contextStyles) {
        return this.log(message, context, LogLevel.FATAL, { contextStyles });
    }

    /**
     * Log an inspected value
     *
     * @param {*} value
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    inspectValue(value, context, contextStyles) {
        // Note: inspect is a special function for node:
        // https://github.com/nodejs/node/blob/a1bda1b4deb08dfb3e06cb778f0db40023b18318/lib/util.js#L210
        value = util.inspect(value, { depth: 6 });
        return this.log(value, context, LogLevel.DEBUG, { contextStyles, styles: [&apos;gray&apos;] });
    }

    /**
     * Log an debugged var
     *
     * @param {String} varName
     * @param {*} varValue
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    inspectVar(varName, varValue, context, contextStyles) {
        varValue = util.inspect(varValue, { depth: 6 });
        return this.log(varName + &apos; = &apos; + varValue, context, LogLevel.DEBUG, { contextStyles, styles: [&apos;cyan&apos;] });
    }

    /**
     * Log an sucess message
     *
     * @param {String} message
     * @param {Object} [context]
     * @param {Object} [contextStyles]
     * @return {Logger}
     */
    success(message, context, contextStyles) {
        return this.log(message, context, LogLevel.INFO, {
            contextStyles,
            symbol: &apos;&#x2714;&apos;,
            styles: [&apos;green&apos;, &apos;bold&apos;],
        });
    }

    /**
     * Stores current time in milliseconds
     * in the timers map
     *
     * @param {string} name timer name
     */
    time(name) {
        if (name) {
            if (!this._timers) {
                this._timers = {};
            }

            return this._timers[name] = Date.now();
        }

        return Date.now();
    }

    /**
    * Finds difference between when this method
    * was called and when the respective time method
    * was called, then logs out the difference
    * and deletes the original record
    *
    * @param {Number=} time return of previous call to time()
    * @param {string} name timer name
     * @param {Object} [context]
     * @param {Object} [contextStyles]
    */
    timeEnd(time, name, context, contextStyles) {
        const now = Date.now();

        if (typeof time !== &apos;number&apos;) {
            contextStyles = context;
            context = name;
            name = time;

            if (!this._timers || !this._timers[name]) {
                return;
            }

            time = this._timers[name];
            delete this._timers[name];
        }

        const diffTime = now - time;
        const seconds = diffTime &gt; 1000 &amp;&amp; Math.floor(diffTime / 1000);
        const ms = diffTime - seconds * 1000;

        const message = (name ? name + &apos;: &apos; : &apos;&apos;) + (seconds ? seconds + &apos;s and &apos; : &apos;&apos;) + ms + &apos;ms&apos;;
        this.log(message, context, LogLevel.INFO, { contextStyles });
    }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.1)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
